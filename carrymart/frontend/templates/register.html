{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="card p-4 mt-5">

            <!-- Header -->
            <div class="text-center mb-4">
                <div class="bg-warning text-dark d-inline-flex align-items-center justify-content-center rounded-circle mb-3"
                     style="width:70px;height:70px;">
                    <i class="bi bi-person-plus-fill fs-2"></i>
                </div>
                <h3 class="fw-bold mb-1">Create Your Account</h3>
                <p class="text-muted mb-0">Join MyShop and start shopping üõçÔ∏è</p>
            </div>

            <!-- Form -->
            <div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="username" placeholder="Username">
                    <label for="username">
                        <i class="bi bi-person me-2"></i>Username
                    </label>
                </div>

                <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="email" placeholder="Email">
                    <label for="email">
                        <i class="bi bi-envelope me-2"></i>Email Address
                    </label>
                </div>

                <div class="form-floating mb-3">
                    <input type="password" class="form-control" id="password" placeholder="Password">
                    <label for="password">
                        <i class="bi bi-lock me-2"></i>Password
                    </label>
                </div>

                <button class="btn btn-register w-100 py-2 mt-2" onclick="register()">
                    <i class="bi bi-person-plus me-2"></i>Create Account
                </button>

                <p class="text-center mt-3 small" id="msg"></p>
            </div>

            <!-- Footer Link -->
            <div class="text-center mt-3">
                <p class="small text-muted mb-0">
                    Already have an account? 
                    <a href="{% url 'login' %}" class="text-warning fw-semibold text-decoration-none">Login</a>
                </p>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function register() {
    const btn = event.target;
    btn.innerHTML = '<i class="bi bi-arrow-repeat"></i> Creating...';
    btn.disabled = true;

    fetch('http://127.0.0.1:8000/users/register/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            username: document.getElementById('username').value,
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
        })
    })
    .then(res => res.json())
    .then(data => {
        const msg = document.getElementById('msg');

        if (data.message || data.id) {
            msg.className = 'text-success text-center mt-3';
            msg.innerHTML = '<i class="bi bi-check-circle me-1"></i> Registration successful!';
            setTimeout(() => window.location.href = '', 1500);
        } else {
            msg.className = 'text-danger text-center mt-3';
            msg.innerText = JSON.stringify(data);
        }

        btn.innerHTML = '<i class="bi bi-person-plus me-2"></i>Create Account';
        btn.disabled = false;
    })
    .catch(() => {
        const msg = document.getElementById('msg');
        msg.className = 'text-danger text-center mt-3';
        msg.innerText = 'Something went wrong. Try again.';
        btn.innerHTML = '<i class="bi bi-person-plus me-2"></i>Create Account';
        btn.disabled = false;
    });
}
</script>
{% endblock %}
