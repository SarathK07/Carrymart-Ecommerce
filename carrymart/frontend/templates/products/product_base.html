<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}MyShop{% endblock %}</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f7fb;
        }

        /* Navbar */
        .main-navbar {
            background: linear-gradient(135deg, #2874f0, #0047d4);
            color: white;
            padding: 14px 28px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .brand {
            font-size: 1.9rem;
            font-weight: 800;
            letter-spacing: .6px;
        }

        /* Search Box */
        .search-box {
            background: white;
            border-radius: 14px;
            padding: 8px 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.07);
            transition: all 0.2s ease;
        }

        .search-box:focus-within {
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .search-box input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 14px;
        }

        /* Buttons */
        .login-btn {
            background: white;
            color: #2874f0;
            font-weight: 600;
            border-radius: 12px;
            padding: 8px 22px;
            border: none;
            transition: 0.2s ease;
        }

        .login-btn:hover {
            background: #eaf0ff;
            transform: translateY(-1px);
        }

        .cart-btn {
            color: white;
            font-weight: 600;
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: -6px;
            right: -10px;
            background: #ff3b3b;
            color: white;
            font-size: 11px;
            padding: 3px 7px;
            border-radius: 50px;
            font-weight: 700;
        }

        /* Wrapper */
        .page-wrapper {
            max-width: 1350px;
            margin: auto;
            padding: 28px 20px;
        }

        /* Product Card */
        .product-card {
            background: white;
            border-radius: 18px;
            transition: all 0.25s ease;
            height: 100%;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.03);
        }

        .product-card:hover {
            transform: translateY(-6px) scale(1.01);
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
        }

        .product-image {
            height: 210px;
            background: linear-gradient(135deg, #f8faff, #eef2ff);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-image img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        /* Footer spacer */
        .bottom-space {
            height: 70px;
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body>

<!-- ðŸ”· Premium Navbar -->
<nav class="main-navbar d-flex align-items-center justify-content-between">

    <!-- Left -->
    <div class="d-flex align-items-center gap-4 flex-grow-1 me-4">
    <!-- Brand clickable -->
    <a href="{% url 'dashboard' %}" class="brand text-decoration-none text-white">
        MyShop
    </a>

    <!-- Search Box -->
    <div class="search-box d-flex align-items-center w-100">
        <i class="bi bi-search me-2 text-muted"></i>
        <input type="text" placeholder="Search for products, brands and more">
    </div>
</div>


    <!-- Right -->
    <div class="d-flex align-items-center gap-4">

        <span id="user-name" class="fw-semibold d-none d-md-inline"></span>

        <!-- <a href="/" id="login-btn" class="btn login-btn btn-sm">Loginsss</a> -->

        <button id="logout-btn" onclick="logout()" class="btn btn-light btn-sm d-none">
            Logout
        </button>

        <a href="/cart/" class="cart-btn text-decoration-none">
            <i class="bi bi-cart3 fs-5"></i>
            <span class="ms-1">Cart</span>
            <span class="cart-badge" id="cart-count">0</span>
        </a>
    </div>

</nav>

<!-- âœ… Content -->
<div class="page-wrapper">
    {% block content %}{% endblock %}
</div>

<div class="bottom-space"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const token = localStorage.getItem("token");

// --- Navbar logic ---{}
const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const userNameText = document.getElementById("user-name");

if (token) {
    loginBtn.classList.add("d-none");
    logoutBtn.classList.remove("d-none");

    // Load user info
    fetch("http://127.0.0.1:8000/users/dashboard-data/", {
        headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
        userNameText.innerText = "Hi, " + data.username;
    });

    // Cart count
    fetch("http://127.0.0.1:8000/cart/viewcart/", {
        headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("cart-count").innerText = data.length;
    });
}

// --- Logout ---
function logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("refresh");
    window.location.href = "/";
}
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
